<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Multicore OCaml</title>
  <meta name="description" content="The goal of Multicore OCaml is to add shared memory parallelism toOCaml. Our implementation uses algebraic effects to compose concurrency and supports parall...">
  <!-- todo: include this into main.css -->
  <link rel="stylesheet" href="/css/font-awesome.css">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://ocamllabs.github.io//doc/multicore.html">
  <link rel="alternate" type="application/rss+xml" title="OCaml Labs" href="https://ocamllabs.github.io//feed.xml">
</head>

  <body>
    <div class="page-content">
      <div class="container">
        <div class="three columns">
          <header class="site-header">

  <h2 class="logo">
   <a href="/">OCaml Labs</a><br />
   
   <img width="100px" src="/assets/img/origami-camel.png" />
   
  </h2>

  <div class="nav">
    
    <label for="menu-toggle" class="menu-icon">
        <!--div data-icon="ei-navicon"></div-->
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
    </label>
    <input type="checkbox" id="menu-toggle">

    <div class="site-nav">
      <nav>
        <ul class="page-link">
          <li><a href="/">Home</a></li>
          <li><a href="/news">News</a></li>
          <li><a href="/doc">Projects</a></li>
          <li><a href="/community">Community</a></li>
          <li><a href="/people">People</a></li>
          <li><a href="/papers">Papers</a></li>
          <li><a href="/talks">Talks</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="/feed.xml">RSS</a></li>
        </ul>
      </nav>
    </div>

  </div>
</header>

        </div>

        <div class="nine columns" style="z-index:100;">
          <div class="wrapper">
            <article class="post">

  <header class="post-header">
    <h1 class="post-title">Multicore OCaml</h1>
  </header>

  <div class="article-content">
    <p>The goal of <a href="https://github.com/ocamllabs/ocaml-multicore">Multicore OCaml</a> is to add shared memory parallelism to
OCaml. Our implementation uses <a href="http://www.eff-lang.org/">algebraic effects</a> to compose concurrency and supports parallelism through domains and incremental GC. Rather than adding a specific multicore scheduler into the runtime system, we’re providing the minimum required toolset in the form of pluggable schedulers.</p>

<p><strong>Memory Model</strong></p>

<p>Using shared memory allows sharing of complex data structures and selective parallelisation of hot spots with having to resort to an entire data structure redesign. We are working on a comprehensive and safe threading memory model for data-race-free programs in multicore OCaml.</p>

<p>Read the <a href="https://github.com/ocamllabs/ocaml-multicore/wiki/Memory-model">draft memory model</a> for further details.</p>

<p><strong>Native code support</strong></p>

<p>Native code support for is <a href="https://github.com/ocamllabs/ocaml-multicore/commit/fc366191ff17fffa24aac34fad64c398d462af6d">here</a>! There is a PR under review to push the multicore branch up to 4.02.2 to allow for installation of your favourite packages from opam. The goal is to benchmark this new 4.02.2 multicore version with the standard version.</p>

<p><strong><a href="https://github.com/ocamllabs/reagents">Reagents</a></strong></p>

<p>Composable, lock-free concurrency library for expressing fine-grained parallel programs on Multicore OCaml.</p>

<h2 id="why-multicore">Why Multicore?</h2>

<p>OCaml has good monadic concurrency libraries (<code class="highlighter-rouge">lwt</code> and <code class="highlighter-rouge">async</code>) but the long term goal is to move away from the monadic model towards modular libraries that support true parallelism - concurrent threads of execution multiplexed over available cores. Currently, threading is supported in OCaml via the global interpreter lock (GIL), but this prohibits multiple threads running OCaml code at any one time. Our goal is to design and implement an OCaml runtime capable of shared-memory parallelism.</p>

<h2 id="challenges">Challenges</h2>

<p>Adding shared-memory parallelism to an existing language presents an interesting set of challenges. As well as the difficulties of memory management in a parallel setting, we must maintain as much backwards compatibility as practicable. This includes not just compatibility of the language semantics, but also of the performance profile, memory usage and C bindings.</p>

<p>The biggest challenge is implementing the garbage collector. GC in OCaml is interesting because of pervasive immutability. Many objects are immutable, which simplifies some aspects of a parallel GC but requires the GC to sustain a very high allocation rate. Operations on immutable objects are very fast in OCaml: allocation is by bumping a pointer, initialising writes (the only ones) are done with no barriers, and reads require no barriers. Our design is focussed on keeping these operations as fast as they are at the moment, with some compromises for mutable objects.</p>

<p>Read more about Multicore OCaml on the <a href="https://github.com/ocamllabs/ocaml-multicore/wiki">repository wiki</a>.</p>

<hr />

<h2>Recent Activity</h2>
<div class="post_news">



<div class="post_news_mini_header">News</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">28 Apr, 2017</span>:
<a href="/general/2017/04/28/ARM64Multicore.html">Multicore OCaml ARM64 Backend</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">1 Mar, 2017</span>:
<a href="/rfc/2017/03/01/multicore-memory-model.html">Formalizing the OCaml Multicore Memory Model</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">30 Jan, 2017</span>:
<a href="/projects/2017/01/30/MulticoreOSX.html">Multicore OCaml Compiling on MacOSX</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">14 Sep, 2016</span>:
<a href="/events/2016/09/14/reagents-talk-fb.html">Effective Parallelism with Reagents @ London Facebook Faculty Summit</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">28 Jun, 2016</span>:
<a href="/events/2016/06/28/js-fp-meetup.html">Multicore OCaml and Reagents - LDN Functionals @ Jane Street</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">13 Jun, 2016</span>:
<a href="/projects/2016/06/13/lock-free-programming.html">Lock-free Programming for the Masses</a>
</div>

<div class="post_title_light">
  <i class="fa fa-newspaper-o"></i>
   <span class="post_date">9 Jun, 2016</span>:
<a href="/general/2016/06/09/busy-spring-week-2016.html">A Busy Week - Multicore, Releases, Interns and Visitors</a>
</div>






<div class="post_news_mini_header">Papers</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">9 Sep, 2017</span>:
  <a href="/papers/#papers-memory-model-ocaml17">A Memory Model for Multicore OCaml</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">7 Sep, 2017</span>:
  <a href="/papers/#papers-awkward-squad-ml17">Effectively Tackling the Awkward Squad</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">3 Sep, 2017</span>:
  <a href="/papers/#papers-cps-effects-fscd17">Continuation Passing Style for Effect Handlers</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">30 Apr, 2017</span>:
  <a href="/papers/#papers-eff17">Eff directly in OCaml</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">23 Sep, 2016</span>:
  <a href="/papers/#papers-effects16">Effective Concurrency with Algebraic Effects</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">22 Sep, 2016</span>:
  <a href="/papers/#papers-multiml16">Migrating MultiMLton to the Cloud</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">22 Sep, 2016</span>:
  <a href="/papers/#papers-links16">Compiling Links Effect Handlers to the OCaml Backend</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">22 Sep, 2016</span>:
  <a href="/papers/#papers-eff16">Eff Directly in OCaml</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">27 Jun, 2016</span>:
  <a href="/papers/#papers-haskell16">Composable Scheduler Activations for Haskell</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">4 Sep, 2015</span>:
  <a href="/papers/#papers-effects15">Effective Concurrency through Algebraic Effects</a>
</div>

<div class="post_title_light">
  <i class="fa fa-book"></i>
  <span class="post_date">5 Sep, 2014</span>:
  <a href="/papers/#papers-multicore14">Multicore OCaml</a>
</div>






<div class="post_news_mini_header">Talks</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">20 Jul, 2017</span>:
  <a href="/talks/#talks-srgseminarmulticoregc17">A Deep Dive Into Multicore OCaml Garbage Collector</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">30 Jun, 2017</span>:
  <a href="/talks/#talks-jsgnycmulticoregc17">A Deep Dive Into Multicore OCaml Garbage Collector</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">29 Jun, 2017</span>:
  <a href="/talks/#talks-effectfuliojsg17">Effective I/O</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">14 Sep, 2016</span>:
  <a href="/talks/#talks-fbfs16">Effective parallelism with Reagents</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">14 Jun, 2016</span>:
  <a href="/talks/#talks-ldnfunc16kc">OCaml Multicore and Programming with Reagents</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">26 Apr, 2016</span>:
  <a href="/talks/#talks-netoshillerstrom16">Towards Compilation of Affine Algebraic Effect Handlers</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">28 Jan, 2016</span>:
  <a href="/talks/#talks-fbtt16">Concurrent and Multicore OCaml: A deep dive</a>
</div>

<div class="post_title_light">
  <i class="fa fa-users"></i>
  <span class="post_date">18 Nov, 2015</span>:
  <a href="/talks/#talks-inriadev15">Multicore OCaml Update</a>
</div>




<div class="post_news_mini_header">Blogs</div>

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 
   
 

 

 

 

 

 

 

 

 
   
 
   
 
   
 
   
   <div class="post_title_light">
     <i class="fa fa-external-link"></i>
     <span class="post_date">11 Jun, 2016</span>:
     <a href="http://kcsrk.info/ocaml/multicore/2016/06/11/lock-free/">Lock-free programming for the masses</a> by <a href="/authors/kc.html">KC Sivaramakrishnan</a>
   </div>
   
 
   
 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 



</div>


  </div>

</article>

          </div>
        </div>
      </div>
      <footer class="site-footer">
  <div class="container">
    <div class="footer left column one-half">
      <section class="small-font">
        Content © 2012-2017 under a <a href="https://wiki.creativecommons.org/wiki/CC0">CC0</a> license.<br />
        Theme based on <a href="https://github.com/wild-flame/jekyll-simple">Jekyll-Simple</a> by <a href="http://wildflame.me">wildflame</a>.
      </section>
    </div>

    <div class="footer right column one-half">
      <section class="small-font">
        
        <a href="https://github.com/ocamllabs"><i class="fa fa-github fa-2x"></i></a>
        
        
        <a href="https://twitter.com/ocamllabs"><i class="fa fa-twitter fa-2x"></i></a>
        
      </section>
    </div>
  </div>
</footer>
 
    </div>
  </body>
</html>
